{% extends "base.html" %}
{% block title %}Riwayat Booking{% endblock %}

{% block content %}
<h2 class="mb-4">Riwayat Booking</h2>

{% if items %}
  <div class="table-responsive">
    <table class="table table-dark table-striped align-middle">
      <thead>
        <tr>
          <th>ID</th>
          <th>Film</th>
          <th>Jadwal</th>
          <th>Kursi</th>
          <th>Total</th>
          <th>Status</th>
          <th>Pembayaran</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody>
        {% for it in items %}
          {% set b = it.booking %}
          {% set s = it.schedule %}
          {% set f = it.film %}
          <tr>
            <td>#{{ b.id }}</td>
            <td>{{ f.title if f else "-" }}</td>
            <td>
              {% if s %}
                {{ s.show_time.strftime('%d %b %Y %H:%M') }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>{{ b.seats }}</td>
            <td>Rp{{ "{:,}".format(b.total).replace(",", ".") }}</td>
            <td>{{ b.status }}</td>
            <td>
              {% if b.payment_method and b.paid_at %}
                {{ b.payment_method }} • {{ b.paid_at.strftime('%Y-%m-%d') }}
              {% else %}
                -
              {% endif %}
            </td>
            <td class="d-flex gap-2">
              {% if s %}
                <!-- ✅ Repeat Order: prefill seat dari booking lama -->
                <a class="btn btn-sm btn-accent"
                   href="{{ url_for('public.choose_seat', schedule_id=s.id) }}?repeat={{ b.id }}">
                  Repeat
                </a>

                <!-- opsional: langsung ke checkout booking lama -->
                <a class="btn btn-sm btn-outline-light"
                   href="{{ url_for('public.checkout', booking_id=b.id) }}">
                  Checkout
                </a>
              {% else %}
                <span class="text-muted">Jadwal tidak ada</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <p class="text-muted">Belum ada booking.</p>
{% endif %}
{% endblock %}
