{% extends "base.html" %}
{% block title %}Riwayat Booking{% endblock %}

{% block content %}
<h2 class="mb-4">Riwayat Booking</h2>

{% if items %}
<div class="table-responsive">
  <table class="table table-dark table-striped align-middle">
    <thead>
      <tr>
        <th>ID</th>
        <th>Film</th>
        <th>Jadwal</th>
        <th>Kursi</th>
        <th>Total</th>
        <th>Status</th>
        <th>Pembayaran</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody>
      {% for it in items %}
        {% set b = it.booking %}
        {% set s = it.schedule %}
        {% set f = it.film %}
        <tr>
          <td>#{{ b.id }}</td>

          <td>{{ f.title if f else "-" }}</td>

          <td>
            {% if s %}
              {{ s.show_time.strftime('%d %b %Y %H:%M') }}
            {% else %}
              <span class="text-muted">-</span>
            {% endif %}
          </td>

          <td>{{ b.seats }}</td>

          <td>Rp {{ "{:,}".format(b.total).replace(",", ".") }}</td>

          <td>
            {% if b.status == "PAID" %}
              <span class="badge bg-success">Lunas</span>
            {% elif b.status == "PENDING_PAYMENT" %}
              <span class="badge bg-warning text-dark">Menunggu Konfirmasi</span>
            {% elif b.status == "REJECTED" %}
              <span class="badge bg-danger">Ditolak</span>
            {% else %}
              <span class="badge bg-secondary">{{ b.status }}</span>
            {% endif %}
          </td>

          <td>
            {% if b.payment_method and b.paid_at %}
              {{ b.payment_method }}<br>
              <small class="text-muted">
                {{ b.paid_at.strftime('%d %b %Y') }}
              </small>
            {% else %}
              <span class="text-muted">-</span>
            {% endif %}
          </td>

          <!-- âœ… AKSI -->
          <td>
            {% if b.status == "PAID" %}
              <a href="{{ url_for('public.ticket_pdf', booking_id=b.id) }}"
                 class="btn btn-outline-info btn-sm"
                 target="_blank">
                ðŸ“„ Download Tiket
              </a>
            {% else %}
              <span class="text-muted">-</span>
            {% endif %}
          </td>

        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
<p class="text-muted">Belum ada booking.</p>
{% endif %}
{% endblock %}
